<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫ïÂ≠óÊ£ãÊ∏∏Êàè</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .main-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            max-width: 1400px;
            width: 100%;
        }
        
        .game-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        h1 {
            color: white;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            margin: 20px auto;
            background-color: #333;
            padding: 5px;
            border-radius: 10px;
        }
        
        .cell {
            width: 100px;
            height: 100px;
            background-color: white;
            border: none;
            font-size: 36px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 5px;
            color: #333;
        }
        
        .cell:hover {
            background-color: #f0f0f0;
            transform: scale(1.05);
        }
        
        .cell:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .x {
            color: #e74c3c;
        }
        
        .o {
            color: #3498db;
        }
        
        .game-info {
            color: white;
            margin: 20px 0;
            font-size: 18px;
        }
        
        .current-player {
            font-weight: bold;
            font-size: 20px;
            margin: 15px 0;
        }
        
        .reset-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin-top: 20px;
        }
        
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .game-controls {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        
        .mode-selection {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .mode-btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .mode-btn.active {
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            color: #333;
        }
        
        .difficulty-selection {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .difficulty-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            font-size: 12px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .difficulty-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .ai-thinking {
            color: #ffd700;
            font-style: italic;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }
        
        .scoreboard {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            min-width: 200px;
            color: white;
        }
        
        .scoreboard h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 24px;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            transition: all 0.3s ease;
        }
        
        .score-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .player-name {
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .player-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .player-x .player-icon {
            background: #e74c3c;
            color: white;
        }
        
        .player-o .player-icon {
            background: #3498db;
            color: white;
        }
        
        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .reset-scores-btn {
            width: 100%;
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            padding: 12px;
            font-size: 14px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .reset-scores-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .game-stats {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }
        
        .stats-title {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 10px;
        }
        
        .stats-value {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
        }
        
        .ai-analysis {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            min-width: 350px;
            max-width: 450px;
            color: white;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .ai-analysis h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 20px;
        }
        
        .decision-tree {
            margin: 15px 0;
        }
        
        .tree-node {
            margin: 10px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        
        .tree-node.best-move {
            border-left-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }
        
        .move-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .move-position {
            font-weight: bold;
            color: #ffd700;
        }
        
        .move-score {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        .score-positive {
            background: #27ae60;
            color: white;
        }
        
        .score-negative {
            background: #e74c3c;
            color: white;
        }
        
        .score-neutral {
            background: #95a5a6;
            color: white;
        }
        
        .mini-board {
            display: grid;
            grid-template-columns: repeat(3, 20px);
            grid-template-rows: repeat(3, 20px);
            gap: 2px;
            margin: 8px 0;
            justify-content: center;
        }
        
        .mini-cell {
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        
        .mini-cell.x {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.2);
        }
        
        .mini-cell.o {
            color: #3498db;
            background: rgba(52, 152, 219, 0.2);
        }
        
        .mini-cell.new-move {
            background: #ffd700;
            color: #333;
            animation: highlight 0.5s ease-in-out;
        }
        
        @keyframes highlight {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .depth-info {
            font-size: 11px;
            color: #bdc3c7;
            margin-top: 5px;
        }
        
        .analysis-summary {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }
        
        .summary-title {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .clear-analysis-btn {
            width: 100%;
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            border: none;
            padding: 10px;
            font-size: 12px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .clear-analysis-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .winner {
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Â∑¶‰æßËÆ°ÂàÜÊùø -->
        <div class="scoreboard">
            <h2>üèÜ ËÆ°ÂàÜÊùø</h2>
            <div class="score-item player-x">
                <div class="player-name">
                    <div class="player-icon">X</div>
                    <span id="player1Name">Áé©ÂÆ∂1</span>
                </div>
                <div class="score-value" id="player1Score">0</div>
            </div>
            <div class="score-item player-o">
                <div class="player-name">
                    <div class="player-icon">O</div>
                    <span id="player2Name">Áé©ÂÆ∂2</span>
                </div>
                <div class="score-value" id="player2Score">0</div>
            </div>
            <div class="game-stats">
                <div class="stats-title">ÊÄªÂ±ÄÊï∞</div>
                <div class="stats-value" id="totalGames">0</div>
            </div>
            <div class="game-stats">
                <div class="stats-title">Âπ≥Â±Ä</div>
                <div class="stats-value" id="drawGames">0</div>
            </div>
            <button class="reset-scores-btn" onclick="resetScores()">ÈáçÁΩÆÊÄªÂàÜ</button>
        </div>
        
        <!-- Âè≥‰æßÊ∏∏ÊàèÂå∫Âüü -->
        <div class="game-container">
        <h1 id="add">‰∫ïÂ≠óÊ£ãÊ∏∏Êàè</h1>
        
        <div class="game-controls">
            <div class="mode-selection">
                <button class="mode-btn active" id="pvpMode" onclick="setGameMode('pvp')">‰∫∫‰∫∫ÂØπÊàò</button>
                <button class="mode-btn" id="pvcMode" onclick="setGameMode('pvc')">‰∫∫Êú∫ÂØπÊàò</button>
            </div>
            
            <div class="difficulty-selection" id="difficultySelection" style="display: none;">
                <button class="difficulty-btn active" id="easyBtn" onclick="setDifficulty('easy')">ÁÆÄÂçï</button>
                <button class="difficulty-btn" id="mediumBtn" onclick="setDifficulty('medium')">‰∏≠Á≠â</button>
                <button class="difficulty-btn" id="hardBtn" onclick="setDifficulty('hard')">Âõ∞Èöæ</button>
            </div>
        </div>
        
        <div class="current-player" id="currentPlayer">ÂΩìÂâçÁé©ÂÆ∂: X</div>
        <div class="game-board" id="gameBoard">
            <button class="cell" data-index="0" onclick="makeMove(0)"></button>
            <button class="cell" data-index="1" onclick="makeMove(1)"></button>
            <button class="cell" data-index="2" onclick="makeMove(2)"></button>
            <button class="cell" data-index="3" onclick="makeMove(3)"></button>
            <button class="cell" data-index="4" onclick="makeMove(4)"></button>
            <button class="cell" data-index="5" onclick="makeMove(5)"></button>
            <button class="cell" data-index="6" onclick="makeMove(6)"></button>
            <button class="cell" data-index="7" onclick="makeMove(7)"></button>
            <button class="cell" data-index="8" onclick="makeMove(8)"></button>
        </div>
        <div class="game-info" id="gameInfo">ÁÇπÂáªÊ†ºÂ≠êÂºÄÂßãÊ∏∏Êàè</div>
        <button class="reset-btn" onclick="resetGame()">ÈáçÊñ∞ÂºÄÂßã</button>
        </div>
        
        <!-- Âè≥‰æßAIÂàÜÊûêÈù¢Êùø -->
        <div class="ai-analysis" id="aiAnalysis" style="display: none;">
            <h2>ü§ñ AIÂÜ≥Á≠ñÂàÜÊûê</h2>
            <div class="analysis-summary">
                <div class="summary-title">ÂΩìÂâçÂàÜÊûê</div>
                <div id="analysisStatus">Á≠âÂæÖAI‰∏ãÊ£ã...</div>
            </div>
            <div class="decision-tree" id="decisionTree"></div>
            <button class="clear-analysis-btn" onclick="clearAnalysis()">Ê∏ÖÈô§ÂàÜÊûê</button>
        </div>
    </div>

    <script>

        function add(finalnumber){
            let total = 0;

            for (let i = 1; i <= finalnumber; i++) {
                total += i;
            }

            return total;
        }
        let dashazi = 1

        let ddd = 0;
        // console.log("Â§ßÂÇªÂ≠ê:", ddd);

        // let domh1 = document.getElementById('add');
        // domh1.textContent = `‰∫ïÂ≠óÊ£ãÊ∏∏Êàè Â§ßÂÇªÂ≠ê${ddd}`;


        let currentPlayer = 'X';
        let gameBoard = ['', '', '', '', '', '', '', '', ''];
        let gameActive = true;
        let gameMode = 'pvp'; // 'pvp' = ‰∫∫‰∫∫ÂØπÊàò, 'pvc' = ‰∫∫Êú∫ÂØπÊàò
        let aiDifficulty = 'easy'; // 'easy', 'medium', 'hard'
        let isAiTurn = false;
        
        // ËÆ°ÂàÜÁ≥ªÁªüÂèòÈáè
        let player1Score = 0; // XÁé©ÂÆ∂ÁöÑÂæóÂàÜ
        let player2Score = 0; // OÁé©ÂÆ∂ÁöÑÂæóÂàÜ
        let totalGames = 0;   // ÊÄªÊ∏∏ÊàèÂ±ÄÊï∞
        let drawGames = 0;    // Âπ≥Â±ÄÊ¨°Êï∞
        
        // AIÂàÜÊûêÁ≥ªÁªüÂèòÈáè
        let analysisData = [];
        let currentAnalysisId = 0;
        
        const winningConditions = [
            [0, 1, 2],
            [3, 4, 5],
            [6, 7, 8],
            [0, 3, 6],
            [1, 4, 7],
            [2, 5, 8],
            [0, 4, 8],
            [2, 4, 6]
        ];

        function setGameMode(mode) {
            gameMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode === 'pvp' ? 'pvpMode' : 'pvcMode').classList.add('active');
            
            const difficultySelection = document.getElementById('difficultySelection');
            const aiAnalysis = document.getElementById('aiAnalysis');
            
            if (mode === 'pvc') {
                difficultySelection.style.display = 'flex';
                document.getElementById('player2Name').textContent = 'ÁîµËÑë';
                // Âè™Âú®Âõ∞ÈöæÊ®°Âºè‰∏ãÊòæÁ§∫AIÂàÜÊûê
                if (aiDifficulty === 'hard') {
                    aiAnalysis.style.display = 'block';
                }
            } else {
                difficultySelection.style.display = 'none';
                document.getElementById('player2Name').textContent = 'Áé©ÂÆ∂2';
                aiAnalysis.style.display = 'none';
            }
            
            resetGame();
        }

        function setDifficulty(difficulty) {
            aiDifficulty = difficulty;
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(difficulty + 'Btn').classList.add('active');
            
            const aiAnalysis = document.getElementById('aiAnalysis');
            if (gameMode === 'pvc' && difficulty === 'hard') {
                aiAnalysis.style.display = 'block';
            } else {
                aiAnalysis.style.display = 'none';
            }
            
            resetGame();
        }

        function makeMove(index) {
            dashazi = dashazi + 1;
            if (gameBoard[index] !== '' || !gameActive || isAiTurn) {
                return;
            }
            
            executeMove(index, currentPlayer);
            
            if (checkWinner()) {
                endGame(`Áé©ÂÆ∂ ${currentPlayer} Ëé∑ËÉúÔºÅüéâ`);
                return;
            }
            
            if (gameBoard.every(cell => cell !== '')) {
                endGame('Âπ≥Â±ÄÔºÅü§ù');
                return;
            }
            
            switchPlayer();
            
            // Â¶ÇÊûúÊòØ‰∫∫Êú∫ÂØπÊàòÊ®°Âºè‰∏îËΩÆÂà∞ÁîµËÑë
            if (gameMode === 'pvc' && currentPlayer === 'O') {
                isAiTurn = true;
                document.getElementById('currentPlayer').textContent = 'ÁîµËÑëÊÄùËÄÉ‰∏≠...';
                document.getElementById('currentPlayer').classList.add('ai-thinking');
                
                setTimeout(() => {
                    makeAiMove();
                }, Math.random() * 1000 + 500); // ÈöèÊú∫Âª∂Ëøü500-1500ms
            }
        }

        function executeMove(index, player) {
            gameBoard[index] = player;
            const cell = document.querySelector(`[data-index="${index}"]`);
            cell.textContent = player;
            cell.classList.add(player.toLowerCase());
            cell.disabled = true;
        }

        function switchPlayer() {
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            if (gameMode === 'pvp' || currentPlayer === 'X') {
                document.getElementById('currentPlayer').textContent = `ÂΩìÂâçÁé©ÂÆ∂: ${currentPlayer}`;
                document.getElementById('currentPlayer').classList.remove('ai-thinking');
                document.getElementById('gameInfo').textContent = `ËΩÆÂà∞ ${currentPlayer} ‰∫Ü`;
            }
        }

        function makeAiMove() {
            let move;
            
            switch (aiDifficulty) {
                case 'easy':
                    move = getRandomMove();
                    break;
                case 'medium':
                    move = getMediumMove();
                    break;
                case 'hard':
                    move = getHardMove();
                    break;
            }
            
            if (move !== -1) {
                executeMove(move, 'O');
                
                if (checkWinner()) {
                    endGame('ÁîµËÑëËé∑ËÉúÔºÅü§ñ');
                    return;
                }
                
                if (gameBoard.every(cell => cell !== '')) {
                    endGame('Âπ≥Â±ÄÔºÅü§ù');
                    return;
                }
                
                isAiTurn = false;
                switchPlayer();
            }
        }

        // ÁÆÄÂçïAI - ÈöèÊú∫ÁßªÂä®
        function getRandomMove() {
            const availableMoves = gameBoard.map((cell, index) => cell === '' ? index : null).filter(val => val !== null);
            return availableMoves.length > 0 ? availableMoves[Math.floor(Math.random() * availableMoves.length)] : -1;
        }

        // ‰∏≠Á≠âAI - ÁÆÄÂçïÁ≠ñÁï•
        function getMediumMove() {
            // ÂÖàÂ∞ùËØïËé∑ËÉú
            for (let i = 0; i < 9; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'O';
                    if (checkWinner()) {
                        gameBoard[i] = '';
                        return i;
                    }
                    gameBoard[i] = '';
                }
            }
            
            // ÂÜçÂ∞ùËØïÈòªÊ≠¢Áé©ÂÆ∂Ëé∑ËÉú
            for (let i = 0; i < 9; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'X';
                    if (checkWinner()) {
                        gameBoard[i] = '';
                        return i;
                    }
                    gameBoard[i] = '';
                }
            }
            
            // Âê¶ÂàôÈöèÊú∫ÁßªÂä®
            return getRandomMove();
        }

        // Âõ∞ÈöæAI - MinimaxÁÆóÊ≥ïÔºàÂ∏¶ÂàÜÊûêÔºâ
        function getHardMove() {
            analysisData = [];
            currentAnalysisId = 0;
            
            let bestScore = -Infinity;
            let bestMove = -1;
            let moveAnalysis = [];
            
            document.getElementById('analysisStatus').textContent = 'Ê≠£Âú®ÂàÜÊûêÊâÄÊúâÂèØËÉΩËµ∞Ê≥ï...';
            
            for (let i = 0; i < 9; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'O';
                    let score = minimaxWithAnalysis(gameBoard, 0, false, i, `‰ΩçÁΩÆ${i+1}`);
                    gameBoard[i] = '';
                    
                    moveAnalysis.push({
                        position: i,
                        score: score,
                        boardState: [...gameBoard]
                    });
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestMove = i;
                    }
                }
            }
            
            // ÊòæÁ§∫ÂàÜÊûêÁªìÊûú
            displayAnalysis(moveAnalysis, bestMove, bestScore);
            
            return bestMove;
        }

        // ÂéüÂßãminimaxÂáΩÊï∞ÔºàÁî®‰∫éÈùûÂàÜÊûêÊ®°ÂºèÔºâ
        function minimax(board, depth, isMaximizing) {
            let result = checkGameResult();
            if (result !== null) {
                return result;
            }
            
            if (isMaximizing) {
                let bestScore = -Infinity;
                for (let i = 0; i < 9; i++) {
                    if (board[i] === '') {
                        board[i] = 'O';
                        let score = minimax(board, depth + 1, false);
                        board[i] = '';
                        bestScore = Math.max(score, bestScore);
                    }
                }
                return bestScore;
            } else {
                let bestScore = Infinity;
                for (let i = 0; i < 9; i++) {
                    if (board[i] === '') {
                        board[i] = 'X';
                        let score = minimax(board, depth + 1, true);
                        board[i] = '';
                        bestScore = Math.min(score, bestScore);
                    }
                }
                return bestScore;
            }
        }

        function minimaxWithAnalysis(board, depth, isMaximizing, rootMove, movePath) {
            let result = checkGameResult();
            if (result !== null) {
                // ËÆ∞ÂΩïÂè∂Â≠êËäÇÁÇπ
                analysisData.push({
                    id: currentAnalysisId++,
                    board: [...board],
                    depth: depth,
                    score: result,
                    isMaximizing: isMaximizing,
                    rootMove: rootMove,
                    movePath: movePath,
                    isLeaf: true
                });
                return result;
            }
            
            if (isMaximizing) {
                let bestScore = -Infinity;
                let childMoves = [];
                for (let i = 0; i < 9; i++) {
                    if (board[i] === '') {
                        board[i] = 'O';
                        let score = minimaxWithAnalysis(board, depth + 1, false, rootMove, `${movePath} ‚Üí O${i+1}`);
                        board[i] = '';
                        childMoves.push({position: i, score: score});
                        bestScore = Math.max(score, bestScore);
                    }
                }
                
                // ËÆ∞ÂΩïÂÜÖÈÉ®ËäÇÁÇπ
                analysisData.push({
                    id: currentAnalysisId++,
                    board: [...board],
                    depth: depth,
                    score: bestScore,
                    isMaximizing: isMaximizing,
                    rootMove: rootMove,
                    movePath: movePath,
                    isLeaf: false,
                    childMoves: childMoves
                });
                
                return bestScore;
            } else {
                let bestScore = Infinity;
                let childMoves = [];
                for (let i = 0; i < 9; i++) {
                    if (board[i] === '') {
                        board[i] = 'X';
                        let score = minimaxWithAnalysis(board, depth + 1, true, rootMove, `${movePath} ‚Üí X${i+1}`);
                        board[i] = '';
                        childMoves.push({position: i, score: score});
                        bestScore = Math.min(score, bestScore);
                    }
                }
                
                // ËÆ∞ÂΩïÂÜÖÈÉ®ËäÇÁÇπ
                analysisData.push({
                    id: currentAnalysisId++,
                    board: [...board],
                    depth: depth,
                    score: bestScore,
                    isMaximizing: isMaximizing,
                    rootMove: rootMove,
                    movePath: movePath,
                    isLeaf: false,
                    childMoves: childMoves
                });
                
                return bestScore;
            }
        }

        function checkGameResult() {
            
            if (checkWinnerForPlayer('O')) return 10;
            if (checkWinnerForPlayer('X')) return -10;
            if (gameBoard.every(cell => cell !== '')) return 0;
            return null;
        }

        function checkWinnerForPlayer(player) {
            return winningConditions.some(condition => {
                const [a, b, c] = condition;
                return gameBoard[a] === player && gameBoard[b] === player && gameBoard[c] === player;
            });
        }

        function checkWinner() {
            return winningConditions.some(condition => {
                const [a, b, c] = condition;
                return gameBoard[a] && gameBoard[a] === gameBoard[b] && gameBoard[a] === gameBoard[c];
            });
        }

        function endGame(message) {
            ddd = add(dashazi);
            let domh1 = document.getElementById('add');
            domh1.textContent = `‰∫ïÂ≠óÊ£ãÊ∏∏Êàè Â§ßÂÇªÂ≠ê${ddd}`;
            
            // Êõ¥Êñ∞ËÆ°ÂàÜ
            totalGames++;
            if (message.includes('Áé©ÂÆ∂ X')) {
                player1Score++;
            } else if (message.includes('Áé©ÂÆ∂ O') || message.includes('ÁîµËÑëËé∑ËÉú')) {
                player2Score++;
            } else if (message.includes('Âπ≥Â±Ä')) {
                drawGames++;
            }
            
            updateScoreboard();
            
            document.getElementById('gameInfo').textContent = message;
            document.getElementById('currentPlayer').textContent = 'Ê∏∏ÊàèÁªìÊùü';
            document.getElementById('currentPlayer').classList.remove('ai-thinking');
            gameActive = false;
            isAiTurn = false;
            highlightWinningCells();
        }

        function highlightWinningCells() {
            winningConditions.forEach(condition => {
                const [a, b, c] = condition;
                if (gameBoard[a] && gameBoard[a] === gameBoard[b] && gameBoard[a] === gameBoard[c]) {
                    document.querySelector(`[data-index="${a}"]`).classList.add('winner');
                    document.querySelector(`[data-index="${b}"]`).classList.add('winner');
                    document.querySelector(`[data-index="${c}"]`).classList.add('winner');
                }
            });
        }

        function resetGame() {
            currentPlayer = 'X';
            gameBoard = ['', '', '', '', '', '', '', '', ''];
            gameActive = true;
            isAiTurn = false;
            
            document.querySelectorAll('.cell').forEach(cell => {
                cell.textContent = '';
                cell.disabled = false;
                cell.classList.remove('x', 'o', 'winner');
            });
            
            document.getElementById('currentPlayer').textContent = 'ÂΩìÂâçÁé©ÂÆ∂: X';
            document.getElementById('currentPlayer').classList.remove('ai-thinking');
            document.getElementById('gameInfo').textContent = 'ÁÇπÂáªÊ†ºÂ≠êÂºÄÂßãÊ∏∏Êàè';
        }
        
        // Êõ¥Êñ∞ËÆ°ÂàÜÊùøÊòæÁ§∫
        function updateScoreboard() {
            document.getElementById('player1Score').textContent = player1Score;
            document.getElementById('player2Score').textContent = player2Score;
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('drawGames').textContent = drawGames;
        }
        
        // ÈáçÁΩÆÊÄªÂàÜ
        function resetScores() {
            player1Score = 0;
            player2Score = 0;
            totalGames = 0;
            drawGames = 0;
            updateScoreboard();
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñËÆ°ÂàÜÊùø
        window.addEventListener('load', function() {
            updateScoreboard();
        });
        
        // ÊòæÁ§∫AIÂàÜÊûêÁªìÊûú
        function displayAnalysis(moveAnalysis, bestMove, bestScore) {
            const decisionTree = document.getElementById('decisionTree');
            const analysisStatus = document.getElementById('analysisStatus');
            
            decisionTree.innerHTML = '';
            
            analysisStatus.textContent = `ÂàÜÊûêÂÆåÊàêÔºÅÊúÄ‰Ω≥Ëµ∞Ê≥ïÔºö‰ΩçÁΩÆ${bestMove + 1}ÔºàÂæóÂàÜÔºö${bestScore}Ôºâ`;
            
            // ÊåâÂæóÂàÜÊéíÂ∫èÊòæÁ§∫
            moveAnalysis.sort((a, b) => b.score - a.score);
            
            moveAnalysis.forEach((move, index) => {
                const nodeDiv = document.createElement('div');
                nodeDiv.className = `tree-node ${move.position === bestMove ? 'best-move' : ''}`;
                
                const moveInfo = document.createElement('div');
                moveInfo.className = 'move-info';
                
                const positionSpan = document.createElement('span');
                positionSpan.className = 'move-position';
                positionSpan.textContent = `‰ΩçÁΩÆ ${move.position + 1}`;
                
                const scoreSpan = document.createElement('span');
                scoreSpan.className = `move-score ${getScoreClass(move.score)}`;
                scoreSpan.textContent = `ÂæóÂàÜ: ${move.score}`;
                
                moveInfo.appendChild(positionSpan);
                moveInfo.appendChild(scoreSpan);
                
                // ÂàõÂª∫Ëø∑‰Ω†Ê£ãÁõò
                const miniBoard = createMiniBoard([...move.boardState], move.position);
                
                const depthInfo = document.createElement('div');
                depthInfo.className = 'depth-info';
                depthInfo.textContent = `${move.position === bestMove ? '‚úÖ ÊúÄ‰Ω≥ÈÄâÊã©' : ''}`;
                
                nodeDiv.appendChild(moveInfo);
                nodeDiv.appendChild(miniBoard);
                nodeDiv.appendChild(depthInfo);
                
                decisionTree.appendChild(nodeDiv);
            });
        }
        
        // ÂàõÂª∫Ëø∑‰Ω†Ê£ãÁõòÊòæÁ§∫
        function createMiniBoard(boardState, newMovePosition) {
            const miniBoard = document.createElement('div');
            miniBoard.className = 'mini-board';
            
            // ‰∏¥Êó∂ÊîæÁΩÆÊñ∞Ëµ∞Ê≥ïÊù•ÊòæÁ§∫
            const tempBoard = [...boardState];
            tempBoard[newMovePosition] = 'O';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'mini-cell';
                
                if (tempBoard[i] === 'X') {
                    cell.classList.add('x');
                    cell.textContent = 'X';
                } else if (tempBoard[i] === 'O') {
                    cell.classList.add('o');
                    cell.textContent = 'O';
                    if (i === newMovePosition) {
                        cell.classList.add('new-move');
                    }
                }
                
                miniBoard.appendChild(cell);
            }
            
            return miniBoard;
        }
        
        // Ëé∑ÂèñÂæóÂàÜÊ†∑ÂºèÁ±ª
        function getScoreClass(score) {
            if (score > 0) return 'score-positive';
            if (score < 0) return 'score-negative';
            return 'score-neutral';
        }
        
        // Ê∏ÖÈô§ÂàÜÊûêÊï∞ÊçÆ
        function clearAnalysis() {
            document.getElementById('decisionTree').innerHTML = '';
            document.getElementById('analysisStatus').textContent = 'Á≠âÂæÖAI‰∏ãÊ£ã...';
            analysisData = [];
        }
    </script>
</body>
</html>